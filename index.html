<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Meta tags for character set and viewport -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<!-- Page title -->
	<title>Task Tales</title>
	<!-- Link to the main CSS file -->
	<link rel="stylesheet" href="assets/css/style.css"/>
	<!-- Link to Font Awesome for icons -->
	<link rel="stylesheet" href="assets/css/font-awesome-6.4.0.all.min.css"/>
	<!-- Link to Favicon file -->
	<link id="favIcon" rel="shortcut icon" href="assets/images/icon/fav-pink.png" type="image/x-icon"/>
	<!-- Link to animate.css for animations -->
	<link rel="stylesheet" href="assets/css/animate-4.1.1.min.css"/>
	<!-- Link to CSS file for Tippy.js animations, scaling effect -->
	<link rel="stylesheet" href="assets/css/tippy-scale.css"/>
</head>
<body>
<div class="container">
	<header>
		<div id="nav-container">
			<nav>
				<!-- Navigation menu button -->
				<div class="menu-btn">
					<div class="bar"></div>
					<div class="bar"></div>
					<div class="bar"></div>
				</div>
				<div>
					<span id="siteName">TaskTales</span>
				</div>
				<div>
					<!-- Logo -->
					<a href="#">
						<img
								id="logo"
								src="assets/images/logo/logo-pink.png"
								alt="Logo"
						/>
					</a>
				</div>
			</nav>
			<!-- Menu -->
			<div id="menu-container">
				<!-- Links Menu -->
				<div class="menu-content" id="menu">
					<!-- Close menu button -->
					<span class="fas fa-times menu-close"></span>
					<!-- Sign out button -->
					<span class="fa fa-sign-out"></span>
					<!-- GitHub button -->
					<span
					><a
							href="https://github.com/AmiRM4A"
							class="fa-brands fa-github"
					></a
					></span>
					<!-- Colors menu button -->
					<span class="fa-solid fa-paint-roller"></span>
				</div>
				<!-- Colors Menu -->
				<div class="colorMenu menu-content" id="colors-menu">
					<span class="fas fa-times color-menu-close"></span>
					<!-- Color options -->
					<span class="color-item teal"></span>
					<span class="color-item indigo"></span>
					<span class="color-item red"></span>
					<span class="color-item pink"></span>
					<span class="color-item green"></span>
				</div>
			</div>
		</div>
	</header>
	<!-- Tasks Management -->
	<section id="tasks-section">
		<div id="tasks-header">
			<div>
				<h1></h1>
				<span class="blink-caret"></span>
			</div>
			<form>
				<!-- Task input field -->
				<label for="task-input"></label>
				<input
						id="task-input"
						type="text"
						placeholder="Add a task..."
						name="todo-input"
						autocomplete="off"
				/>
				<!-- Add Task button -->
				<button class="add-todo-btn" type="submit">Add Task</button>
			</form>
		</div>
		<div id="tasks-container">
			<div class="todo" id="todos">
				<!-- Tasks will be shown here -->
			</div>
		</div>
	</section>
	<!-- Task Edit Modal -->
	<div class="modal" id="task-edit-modal">
		<div class="modal-content">
			<span class="close-button fas fa-times"></span>
			<h2>Edit Task</h2>
			<form>
				<!-- Hidden input for task ID -->
				<input type="hidden" class="task-id" name="task-id" id="task-id"/>
				<label for="task-title">Title:</label>
				<input type="text" id="task-title" name="task-title"/>
				<label for="task-description">Description:</label>
				<textarea id="task-description" name="task-description"></textarea>
				<!-- Save button -->
				<input type="button" class="btn save-modal" value="Save"/>
			</form>
		</div>
	</div>
</div>
<footer>
	<div>
		Created with <i class="fa-solid fa-heart"></i> by
		<!-- Link to the creator's GitHub profile -->
		<a href="https://github.com/AmiRM4A">Amir</a>
	</div>
</footer>
<!-- Sweet Alert -->
<script src="assets/js/sweetalert2-11.10.8.min.js"></script>
<!-- Font Awesome -->
<!--<script src="assets/js/font-awesome-6.4.0-all.min.js"></script>-->
<!-- Popper.js library for tooltips and popovers -->
<script src="assets/js/popper-2.11.8.min.js"></script>
<!-- Tippy.js library for customizable tooltips -->
<script src="assets/js/tippy-bundle-6.3.7.umd.js"></script>
<!-- jQuery library -->
<script src="assets/js/jquery-3.7.1.min.js"></script>
<!-- Main application script -->
<script type="module">
	// Check if token's data is already set in the session storage
	if (getSessionStorage('Authorization') === null) {
		// Redirect to login page
		removeSessionStorage('user');
		redirectTo(config.baseUrl + '/login.html');
	}

	// Importing necessary functions
	import config from "./config.js";
	import {makeApiRequest, redirectTo, errorAlert} from './assets/js/modules/utilitiesModule.js';
	import {
		setSessionStorage,
		getSessionStorage,
		removeSessionStorage
	} from './assets/js/modules/sessionStorageModule.js';
	import {getUserToken} from './assets/js/modules/utilitiesModule.js';

	$(document).ready(() => {
		// Call API service to get user's data (by token)
		const apiUrl = config.apiUrl + '/me';
		makeApiRequest('POST', apiUrl, null, {Authorization: getUserToken()})
				.then(response => {
					// Saving token's data into session storage if data isn't already saved
					if (getSessionStorage('user')) {
						removeSessionStorage('user');
					}

					setSessionStorage('user', response.data);
				})
				.catch(error => {
					// Redirecting to login page if token is invalid
					if (error.status === 401) {
						removeSessionStorage('Authorization');
						removeSessionStorage('user');
						redirectTo(config.baseUrl + '/login.html');
					} else {
						console.error(error);
						errorAlert();
					}
				});
	});
</script>
<script type="module" src="assets/js/app.js"></script>
</body>
</html>